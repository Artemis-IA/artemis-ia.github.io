{"version":3,"file":"VideoPreview-Cjka1tMr.js","sources":["../../../icons/dist/src/Maximise.svelte","../../../video/dist/shared/VideoTimeline.svelte","../../../video/dist/shared/VideoControls.svelte","../../../video/dist/shared/Player.svelte","../../../video/dist/shared/VideoPreview.svelte"],"sourcesContent":["<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\twidth=\"100%\"\n\theight=\"100%\"\n\tviewBox=\"0 0 24 24\"\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tstroke-width=\"1.5\"\n\tstroke-linecap=\"round\"\n\tstroke-linejoin=\"round\"\n>\n\t<path\n\t\td=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"\n\t/>\n</svg>\n","<script>import { onMount, onDestroy } from \"svelte\";\nexport let videoElement;\nexport let trimmedDuration;\nexport let dragStart;\nexport let dragEnd;\nexport let loadingTimeline;\nlet thumbnails = [];\nlet numberOfThumbnails = 10;\nlet intervalId;\nlet videoDuration;\nlet leftHandlePosition = 0;\nlet rightHandlePosition = 100;\nlet dragging = null;\nconst startDragging = (side) => {\n  dragging = side;\n};\n$:\n  loadingTimeline = thumbnails.length !== numberOfThumbnails;\nconst stopDragging = () => {\n  dragging = null;\n};\nconst drag = (event, distance) => {\n  if (dragging) {\n    const timeline = document.getElementById(\"timeline\");\n    if (!timeline)\n      return;\n    const rect = timeline.getBoundingClientRect();\n    let newPercentage = (event.clientX - rect.left) / rect.width * 100;\n    if (distance) {\n      newPercentage = dragging === \"left\" ? leftHandlePosition + distance : rightHandlePosition + distance;\n    } else {\n      newPercentage = (event.clientX - rect.left) / rect.width * 100;\n    }\n    newPercentage = Math.max(0, Math.min(newPercentage, 100));\n    if (dragging === \"left\") {\n      leftHandlePosition = Math.min(newPercentage, rightHandlePosition);\n      const newTimeLeft = leftHandlePosition / 100 * videoDuration;\n      videoElement.currentTime = newTimeLeft;\n      dragStart = newTimeLeft;\n    } else if (dragging === \"right\") {\n      rightHandlePosition = Math.max(newPercentage, leftHandlePosition);\n      const newTimeRight = rightHandlePosition / 100 * videoDuration;\n      videoElement.currentTime = newTimeRight;\n      dragEnd = newTimeRight;\n    }\n    const startTime = leftHandlePosition / 100 * videoDuration;\n    const endTime = rightHandlePosition / 100 * videoDuration;\n    trimmedDuration = endTime - startTime;\n    leftHandlePosition = leftHandlePosition;\n    rightHandlePosition = rightHandlePosition;\n  }\n};\nconst moveHandle = (e) => {\n  if (dragging) {\n    const distance = 1 / videoDuration * 100;\n    if (e.key === \"ArrowLeft\") {\n      drag({ clientX: 0 }, -distance);\n    } else if (e.key === \"ArrowRight\") {\n      drag({ clientX: 0 }, distance);\n    }\n  }\n};\nconst generateThumbnail = () => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx)\n    return;\n  canvas.width = videoElement.videoWidth;\n  canvas.height = videoElement.videoHeight;\n  ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n  const thumbnail = canvas.toDataURL(\"image/jpeg\", 0.7);\n  thumbnails = [...thumbnails, thumbnail];\n};\nonMount(() => {\n  const loadMetadata = () => {\n    videoDuration = videoElement.duration;\n    const interval = videoDuration / numberOfThumbnails;\n    let captures = 0;\n    const onSeeked = () => {\n      generateThumbnail();\n      captures++;\n      if (captures < numberOfThumbnails) {\n        videoElement.currentTime += interval;\n      } else {\n        videoElement.removeEventListener(\"seeked\", onSeeked);\n      }\n    };\n    videoElement.addEventListener(\"seeked\", onSeeked);\n    videoElement.currentTime = 0;\n  };\n  if (videoElement.readyState >= 1) {\n    loadMetadata();\n  } else {\n    videoElement.addEventListener(\"loadedmetadata\", loadMetadata);\n  }\n});\nonDestroy(() => {\n  window.removeEventListener(\"mousemove\", drag);\n  window.removeEventListener(\"mouseup\", stopDragging);\n  window.removeEventListener(\"keydown\", moveHandle);\n  if (intervalId !== void 0) {\n    clearInterval(intervalId);\n  }\n});\nonMount(() => {\n  window.addEventListener(\"mousemove\", drag);\n  window.addEventListener(\"mouseup\", stopDragging);\n  window.addEventListener(\"keydown\", moveHandle);\n});\n</script>\n\n<div class=\"container\">\n\t{#if loadingTimeline}\n\t\t<div class=\"load-wrap\">\n\t\t\t<span aria-label=\"loading timeline\" class=\"loader\" />\n\t\t</div>\n\t{:else}\n\t\t<div id=\"timeline\" class=\"thumbnail-wrapper\">\n\t\t\t<button\n\t\t\t\taria-label=\"start drag handle for trimming video\"\n\t\t\t\tclass=\"handle left\"\n\t\t\t\ton:mousedown={() => startDragging(\"left\")}\n\t\t\t\ton:blur={stopDragging}\n\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\tif (e.key === \"ArrowLeft\" || e.key == \"ArrowRight\") {\n\t\t\t\t\t\tstartDragging(\"left\");\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tstyle=\"left: {leftHandlePosition}%;\"\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\tclass=\"opaque-layer\"\n\t\t\t\tstyle=\"left: {leftHandlePosition}%; right: {100 - rightHandlePosition}%\"\n\t\t\t/>\n\n\t\t\t{#each thumbnails as thumbnail, i (i)}\n\t\t\t\t<img src={thumbnail} alt={`frame-${i}`} draggable=\"false\" />\n\t\t\t{/each}\n\t\t\t<button\n\t\t\t\taria-label=\"end drag handle for trimming video\"\n\t\t\t\tclass=\"handle right\"\n\t\t\t\ton:mousedown={() => startDragging(\"right\")}\n\t\t\t\ton:blur={stopDragging}\n\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\tif (e.key === \"ArrowLeft\" || e.key == \"ArrowRight\") {\n\t\t\t\t\t\tstartDragging(\"right\");\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tstyle=\"left: {rightHandlePosition}%;\"\n\t\t\t/>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.load-wrap {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 100%;\n\t}\n\t.loader {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tbackground-color: var(--border-color-accent-subdued);\n\t\tanimation: shadowPulse 2s linear infinite;\n\t\tbox-shadow:\n\t\t\t-24px 0 var(--border-color-accent-subdued),\n\t\t\t24px 0 var(--border-color-accent-subdued);\n\t\tmargin: var(--spacing-md);\n\t\tborder-radius: 50%;\n\t\twidth: 10px;\n\t\theight: 10px;\n\t\tscale: 0.5;\n\t}\n\n\t@keyframes shadowPulse {\n\t\t33% {\n\t\t\tbox-shadow:\n\t\t\t\t-24px 0 var(--border-color-accent-subdued),\n\t\t\t\t24px 0 #fff;\n\t\t\tbackground: #fff;\n\t\t}\n\t\t66% {\n\t\t\tbox-shadow:\n\t\t\t\t-24px 0 #fff,\n\t\t\t\t24px 0 #fff;\n\t\t\tbackground: var(--border-color-accent-subdued);\n\t\t}\n\t\t100% {\n\t\t\tbox-shadow:\n\t\t\t\t-24px 0 #fff,\n\t\t\t\t24px 0 var(--border-color-accent-subdued);\n\t\t\tbackground: #fff;\n\t\t}\n\t}\n\n\t.container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin: var(--spacing-lg) var(--spacing-lg) 0 var(--spacing-lg);\n\t}\n\n\t#timeline {\n\t\tdisplay: flex;\n\t\theight: var(--size-10);\n\t\tflex: 1;\n\t\tposition: relative;\n\t}\n\n\timg {\n\t\tflex: 1 1 auto;\n\t\tmin-width: 0;\n\t\tobject-fit: cover;\n\t\theight: var(--size-12);\n\t\tborder: 1px solid var(--block-border-color);\n\t\tuser-select: none;\n\t\tz-index: 1;\n\t}\n\n\t.handle {\n\t\twidth: 3px;\n\t\tbackground-color: var(--color-accent);\n\t\tcursor: ew-resize;\n\t\theight: var(--size-12);\n\t\tz-index: 3;\n\t\tposition: absolute;\n\t}\n\n\t.opaque-layer {\n\t\tbackground-color: rgba(230, 103, 40, 0.25);\n\t\tborder: 1px solid var(--color-accent);\n\t\theight: var(--size-12);\n\t\tposition: absolute;\n\t\tz-index: 2;\n\t}\n</style>\n","<script>import { Undo, Trim } from \"@gradio/icons\";\nimport VideoTimeline from \"./VideoTimeline.svelte\";\nimport { trimVideo } from \"./utils\";\nimport { FFmpeg } from \"@ffmpeg/ffmpeg\";\nimport loadFfmpeg from \"./utils\";\nimport { onMount } from \"svelte\";\nimport { format_time } from \"@gradio/utils\";\nexport let videoElement;\nexport let showRedo = false;\nexport let interactive = true;\nexport let mode = \"\";\nexport let handle_reset_value;\nexport let handle_trim_video;\nexport let processingVideo = false;\nlet ffmpeg;\nonMount(async () => {\n  ffmpeg = await loadFfmpeg();\n});\n$:\n  if (mode === \"edit\" && trimmedDuration === null && videoElement)\n    trimmedDuration = videoElement.duration;\nlet trimmedDuration = null;\nlet dragStart = 0;\nlet dragEnd = 0;\nlet loadingTimeline = false;\nconst toggleTrimmingMode = () => {\n  if (mode === \"edit\") {\n    mode = \"\";\n    trimmedDuration = videoElement.duration;\n  } else {\n    mode = \"edit\";\n  }\n};\n</script>\n\n<div class=\"container\">\n\t{#if mode === \"edit\"}\n\t\t<div class=\"timeline-wrapper\">\n\t\t\t<VideoTimeline\n\t\t\t\t{videoElement}\n\t\t\t\tbind:dragStart\n\t\t\t\tbind:dragEnd\n\t\t\t\tbind:trimmedDuration\n\t\t\t\tbind:loadingTimeline\n\t\t\t/>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"controls\" data-testid=\"waveform-controls\">\n\t\t{#if mode === \"edit\" && trimmedDuration !== null}\n\t\t\t<time\n\t\t\t\taria-label=\"duration of selected region in seconds\"\n\t\t\t\tclass:hidden={loadingTimeline}>{format_time(trimmedDuration)}</time\n\t\t\t>\n\t\t{:else}\n\t\t\t<div />\n\t\t{/if}\n\n\t\t<div class=\"settings-wrapper\">\n\t\t\t{#if showRedo && mode === \"\"}\n\t\t\t\t<button\n\t\t\t\t\tclass=\"action icon\"\n\t\t\t\t\tdisabled={processingVideo}\n\t\t\t\t\taria-label=\"Reset video to initial value\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\thandle_reset_value();\n\t\t\t\t\t\tmode = \"\";\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Undo />\n\t\t\t\t</button>\n\t\t\t{/if}\n\n\t\t\t{#if interactive}\n\t\t\t\t{#if mode === \"\"}\n\t\t\t\t\t<button\n\t\t\t\t\t\tdisabled={processingVideo}\n\t\t\t\t\t\tclass=\"action icon\"\n\t\t\t\t\t\taria-label=\"Trim video to selection\"\n\t\t\t\t\t\ton:click={toggleTrimmingMode}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Trim />\n\t\t\t\t\t</button>\n\t\t\t\t{:else}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass:hidden={loadingTimeline}\n\t\t\t\t\t\tclass=\"text-button\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tmode = \"\";\n\t\t\t\t\t\t\tprocessingVideo = true;\n\t\t\t\t\t\t\ttrimVideo(ffmpeg, dragStart, dragEnd, videoElement)\n\t\t\t\t\t\t\t\t.then((videoBlob) => {\n\t\t\t\t\t\t\t\t\thandle_trim_video(videoBlob);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tprocessingVideo = false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}>Trim</button\n\t\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"text-button\"\n\t\t\t\t\t\tclass:hidden={loadingTimeline}\n\t\t\t\t\t\ton:click={toggleTrimmingMode}>Cancel</button\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.container {\n\t\twidth: 100%;\n\t}\n\ttime {\n\t\tcolor: var(--color-accent);\n\t\tfont-weight: bold;\n\t\tpadding-left: var(--spacing-xs);\n\t}\n\n\t.timeline-wrapper {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 100%;\n\t}\n\t.settings-wrapper {\n\t\tdisplay: flex;\n\t\tjustify-self: self-end;\n\t}\n\t.text-button {\n\t\tborder: 1px solid var(--neutral-400);\n\t\tborder-radius: var(--radius-sm);\n\t\tfont-weight: 300;\n\t\tfont-size: var(--size-3);\n\t\ttext-align: center;\n\t\tcolor: var(--neutral-400);\n\t\theight: var(--size-5);\n\t\tfont-weight: bold;\n\t\tpadding: 0 5px;\n\t\tmargin-left: 5px;\n\t}\n\t.hidden {\n\t\tdisplay: none;\n\t}\n\n\t.text-button:hover,\n\t.text-button:focus {\n\t\tcolor: var(--color-accent);\n\t\tborder-color: var(--color-accent);\n\t}\n\n\t.controls {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tmargin: var(--spacing-lg);\n\t\toverflow: hidden;\n\t\ttext-align: left;\n\t}\n\n\t@media (max-width: 320px) {\n\t\t.controls {\n\t\t\tdisplay: flex;\n\t\t\tflex-wrap: wrap;\n\t\t}\n\n\t\t.controls * {\n\t\t\tmargin: var(--spacing-sm);\n\t\t}\n\n\t\t.controls .text-button {\n\t\t\tmargin-left: 0;\n\t\t}\n\t}\n\t.action {\n\t\twidth: var(--size-5);\n\t\twidth: var(--size-5);\n\t\tcolor: var(--neutral-400);\n\t\tmargin-left: var(--spacing-md);\n\t}\n\n\t.action:disabled {\n\t\tcursor: not-allowed;\n\t\tcolor: var(--border-color-accent-subdued);\n\t}\n\n\t.action:disabled:hover {\n\t\tcolor: var(--border-color-accent-subdued);\n\t}\n\n\t.icon:hover,\n\t.icon:focus {\n\t\tcolor: var(--color-accent);\n\t}\n\n\t.container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n</style>\n","<script>import { createEventDispatcher } from \"svelte\";\nimport { Play, Pause, Maximise, Undo } from \"@gradio/icons\";\nimport Video from \"./Video.svelte\";\nimport VideoControls from \"./VideoControls.svelte\";\nimport { prepare_files } from \"@gradio/client\";\nimport { format_time } from \"@gradio/utils\";\nexport let root = \"\";\nexport let src;\nexport let subtitle = null;\nexport let mirror;\nexport let autoplay;\nexport let loop;\nexport let label = \"test\";\nexport let interactive = false;\nexport let handle_change = () => {\n};\nexport let handle_reset_value = () => {\n};\nexport let upload;\nconst dispatch = createEventDispatcher();\nlet time = 0;\nlet duration;\nlet paused = true;\nlet video;\nlet processingVideo = false;\nfunction handleMove(e) {\n  if (!duration)\n    return;\n  if (e.type === \"click\") {\n    handle_click(e);\n    return;\n  }\n  if (e.type !== \"touchmove\" && !(e.buttons & 1))\n    return;\n  const clientX = e.type === \"touchmove\" ? e.touches[0].clientX : e.clientX;\n  const { left, right } = e.currentTarget.getBoundingClientRect();\n  time = duration * (clientX - left) / (right - left);\n}\nasync function play_pause() {\n  if (document.fullscreenElement != video) {\n    const isPlaying = video.currentTime > 0 && !video.paused && !video.ended && video.readyState > video.HAVE_CURRENT_DATA;\n    if (!isPlaying) {\n      await video.play();\n    } else\n      video.pause();\n  }\n}\nfunction handle_click(e) {\n  const { left, right } = e.currentTarget.getBoundingClientRect();\n  time = duration * (e.clientX - left) / (right - left);\n}\nfunction handle_end() {\n  dispatch(\"stop\");\n  dispatch(\"end\");\n}\nconst handle_trim_video = async (videoBlob) => {\n  let _video_blob = new File([videoBlob], \"video.mp4\");\n  const val = await prepare_files([_video_blob]);\n  let value = ((await upload(val, root))?.filter(Boolean))[0];\n  handle_change(value);\n};\nfunction open_full_screen() {\n  video.requestFullscreen();\n}\n</script>\n\n<div class=\"wrap\">\n\t<div class=\"mirror-wrap\" class:mirror>\n\t\t<Video\n\t\t\t{src}\n\t\t\tpreload=\"auto\"\n\t\t\t{autoplay}\n\t\t\t{loop}\n\t\t\ton:click={play_pause}\n\t\t\ton:play\n\t\t\ton:pause\n\t\t\ton:ended={handle_end}\n\t\t\tbind:currentTime={time}\n\t\t\tbind:duration\n\t\t\tbind:paused\n\t\t\tbind:node={video}\n\t\t\tdata-testid={`${label}-player`}\n\t\t\t{processingVideo}\n\t\t\ton:load\n\t\t>\n\t\t\t<track kind=\"captions\" src={subtitle} default />\n\t\t</Video>\n\t</div>\n\n\t<div class=\"controls\">\n\t\t<div class=\"inner\">\n\t\t\t<span\n\t\t\t\trole=\"button\"\n\t\t\t\ttabindex=\"0\"\n\t\t\t\tclass=\"icon\"\n\t\t\t\taria-label=\"play-pause-replay-button\"\n\t\t\t\ton:click={play_pause}\n\t\t\t\ton:keydown={play_pause}\n\t\t\t>\n\t\t\t\t{#if time === duration}\n\t\t\t\t\t<Undo />\n\t\t\t\t{:else if paused}\n\t\t\t\t\t<Play />\n\t\t\t\t{:else}\n\t\t\t\t\t<Pause />\n\t\t\t\t{/if}\n\t\t\t</span>\n\n\t\t\t<span class=\"time\">{format_time(time)} / {format_time(duration)}</span>\n\n\t\t\t<!-- TODO: implement accessible video timeline for 4.0 -->\n\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\n\t\t\t<!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\n\t\t\t<progress\n\t\t\t\tvalue={time / duration || 0}\n\t\t\t\ton:mousemove={handleMove}\n\t\t\t\ton:touchmove|preventDefault={handleMove}\n\t\t\t\ton:click|stopPropagation|preventDefault={handle_click}\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\trole=\"button\"\n\t\t\t\ttabindex=\"0\"\n\t\t\t\tclass=\"icon\"\n\t\t\t\taria-label=\"full-screen\"\n\t\t\t\ton:click={open_full_screen}\n\t\t\t\ton:keypress={open_full_screen}\n\t\t\t>\n\t\t\t\t<Maximise />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n{#if interactive}\n\t<VideoControls\n\t\tvideoElement={video}\n\t\tshowRedo\n\t\t{handle_trim_video}\n\t\t{handle_reset_value}\n\t\tbind:processingVideo\n\t/>\n{/if}\n\n<style>\n\tspan {\n\t\ttext-shadow: 0 0 8px rgba(0, 0, 0, 0.5);\n\t}\n\n\tprogress {\n\t\tmargin-right: var(--size-3);\n\t\tborder-radius: var(--radius-sm);\n\t\twidth: var(--size-full);\n\t\theight: var(--size-2);\n\t}\n\n\tprogress::-webkit-progress-bar {\n\t\tborder-radius: 2px;\n\t\tbackground-color: rgba(255, 255, 255, 0.2);\n\t\toverflow: hidden;\n\t}\n\n\tprogress::-webkit-progress-value {\n\t\tbackground-color: rgba(255, 255, 255, 0.9);\n\t}\n\n\t.mirror {\n\t\ttransform: scaleX(-1);\n\t}\n\n\t.mirror-wrap {\n\t\tposition: relative;\n\t\theight: 100%;\n\t\twidth: 100%;\n\t}\n\n\t.controls {\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\topacity: 0;\n\t\ttransition: 500ms;\n\t\tmargin: var(--size-2);\n\t\tborder-radius: var(--radius-md);\n\t\tbackground: var(--color-grey-800);\n\t\tpadding: var(--size-2) var(--size-1);\n\t\twidth: calc(100% - 0.375rem * 2);\n\t\twidth: calc(100% - var(--size-2) * 2);\n\t}\n\t.wrap:hover .controls {\n\t\topacity: 1;\n\t}\n\n\t.inner {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding-right: var(--size-2);\n\t\tpadding-left: var(--size-2);\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\t.icon {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\twidth: var(--size-6);\n\t\tcolor: white;\n\t}\n\n\t.time {\n\t\tflex-shrink: 0;\n\t\tmargin-right: var(--size-3);\n\t\tmargin-left: var(--size-3);\n\t\tcolor: white;\n\t\tfont-size: var(--text-sm);\n\t\tfont-family: var(--font-mono);\n\t}\n\t.wrap {\n\t\tposition: relative;\n\t\tbackground-color: var(--background-fill-secondary);\n\t\theight: var(--size-full);\n\t\twidth: var(--size-full);\n\t\tborder-radius: var(--radius-xl);\n\t}\n\t.wrap :global(video) {\n\t\theight: var(--size-full);\n\t\twidth: var(--size-full);\n\t}\n</style>\n","<script>import { createEventDispatcher, afterUpdate, tick } from \"svelte\";\nimport { BlockLabel, Empty, IconButton, ShareButton } from \"@gradio/atoms\";\nimport { Video, Download } from \"@gradio/icons\";\nimport { uploadToHuggingFace } from \"@gradio/utils\";\nimport { DownloadLink } from \"@gradio/wasm/svelte\";\nimport Player from \"./Player.svelte\";\nexport let value = null;\nexport let subtitle = null;\nexport let label = void 0;\nexport let show_label = true;\nexport let autoplay;\nexport let show_share_button = true;\nexport let show_download_button = true;\nexport let loop;\nexport let i18n;\nexport let upload;\nlet old_value = null;\nlet old_subtitle = null;\nconst dispatch = createEventDispatcher();\n$:\n  value && dispatch(\"change\", value);\nafterUpdate(async () => {\n  if (value !== old_value && subtitle !== old_subtitle && old_subtitle !== null) {\n    old_value = value;\n    value = null;\n    await tick();\n    value = old_value;\n  }\n  old_value = value;\n  old_subtitle = subtitle;\n});\n</script>\n\n<BlockLabel {show_label} Icon={Video} label={label || \"Video\"} />\n{#if value === null || value.url === undefined}\n\t<Empty unpadded_box={true} size=\"large\"><Video /></Empty>\n{:else}\n\t{#key value.url}\n\t\t<Player\n\t\t\tsrc={value.url}\n\t\t\tsubtitle={subtitle?.url}\n\t\t\t{autoplay}\n\t\t\ton:play\n\t\t\ton:pause\n\t\t\ton:stop\n\t\t\ton:end\n\t\t\ton:load\n\t\t\tmirror={false}\n\t\t\t{label}\n\t\t\t{loop}\n\t\t\tinteractive={false}\n\t\t\t{upload}\n\t\t/>\n\t{/key}\n\t<div class=\"icon-buttons\" data-testid=\"download-div\">\n\t\t{#if show_download_button}\n\t\t\t<DownloadLink href={value.url} download={value.orig_name || value.path}>\n\t\t\t\t<IconButton Icon={Download} label=\"Download\" />\n\t\t\t</DownloadLink>\n\t\t{/if}\n\t\t{#if show_share_button}\n\t\t\t<ShareButton\n\t\t\t\t{i18n}\n\t\t\t\ton:error\n\t\t\t\ton:share\n\t\t\t\t{value}\n\t\t\t\tformatter={async (value) => {\n\t\t\t\t\tif (!value) return \"\";\n\t\t\t\t\tlet url = await uploadToHuggingFace(value.data, \"url\");\n\t\t\t\t\treturn url;\n\t\t\t\t}}\n\t\t\t/>\n\t\t{/if}\n\t</div>\n{/if}\n\n<style>\n\t.icon-buttons {\n\t\tdisplay: flex;\n\t\tposition: absolute;\n\t\ttop: 6px;\n\t\tright: 6px;\n\t\tgap: var(--size-1);\n\t}\n</style>\n"],"names":["insert","target","svg","anchor","append","path","ctx","i","set_style","div0","div1","button0","button1","div","attr","img","img_src_value","create_if_block","numberOfThumbnails","videoElement","$$props","trimmedDuration","dragStart","dragEnd","loadingTimeline","thumbnails","videoDuration","leftHandlePosition","rightHandlePosition","dragging","startDragging","side","stopDragging","drag","event","distance","timeline","rect","newPercentage","$$invalidate","newTimeLeft","newTimeRight","startTime","endTime","moveHandle","e","generateThumbnail","canvas","thumbnail","onMount","loadMetadata","interval","captures","onSeeked","onDestroy","mousedown_handler","mousedown_handler_1","t_value","format_time","time","dirty","set_data","button","if_block0","create_if_block_4","create_if_block_3","create_if_block_2","div2","showRedo","interactive","mode","handle_reset_value","handle_trim_video","processingVideo","ffmpeg","loadFfmpeg","toggleTrimmingMode","trimVideo","videoBlob","track","track_src_value","t2_value","t4_value","div4","div3","span0","span1","progress","current","t2","t4","root","src","subtitle","mirror","autoplay","loop","label","handle_change","upload","dispatch","createEventDispatcher","duration","paused","video","handleMove","handle_click","clientX","left","right","play_pause","handle_end","_video_blob","val","prepare_files","value","open_full_screen","previous_key","create_if_block_1","safe_not_equal","player_changes","downloadlink_changes","Download","Video","blocklabel_changes","show_label","show_share_button","show_download_button","i18n","old_value","old_subtitle","afterUpdate","tick","uploadToHuggingFace"],"mappings":"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"}