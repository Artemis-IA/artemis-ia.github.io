import{d as te,i as le,e as ie,g as y,y as W,r as D,F as J,z as p,A as k,v as I,C as A,w as Q,E as x,x as M,J as ne,a9 as qe,ah as Ce,aL as S,Y as se,G as re,k as T,H as ae,j as q,aP as Le,O as C,Q as Oe,n as oe,V as z,aQ as L,a7 as O,u as ue,o as fe,q as de,X as Te,h as Ue,m as De,l as Ie,M as Me}from"../lite.js";/* empty css                                                   */function $(t){let e,i,l,s,d=N(t[2])+"",a,u,r,o,b=t[2].orig_name+"",_;return{c(){e=W("div"),i=W("span"),l=W("div"),s=W("progress"),a=D(d),r=J(),o=W("span"),_=D(b),S(s,"visibility","hidden"),S(s,"height","0"),S(s,"width","0"),s.value=u=N(t[2]),p(s,"max","100"),p(s,"class","svelte-1vsfomn"),p(l,"class","progress-bar svelte-1vsfomn"),p(o,"class","file-name svelte-1vsfomn"),p(e,"class","file svelte-1vsfomn")},m(h,c){I(h,e,c),A(e,i),A(i,l),A(l,s),A(s,a),A(e,r),A(e,o),A(o,_)},p(h,c){c&4&&d!==(d=N(h[2])+"")&&Q(a,d),c&4&&u!==(u=N(h[2]))&&(s.value=u),c&4&&b!==(b=h[2].orig_name+"")&&Q(_,b)},d(h){h&&M(e)}}}function Ne(t){let e,i,l,s=t[0].length+"",d,a,u=t[0].length>1?"files":"file",r,o,b,_=t[2]&&$(t);return{c(){e=W("div"),i=W("span"),l=D("Uploading "),d=D(s),a=J(),r=D(u),o=D("..."),b=J(),_&&_.c(),p(i,"class","uploading svelte-1vsfomn"),p(e,"class","wrap svelte-1vsfomn"),k(e,"progress",t[1])},m(h,c){I(h,e,c),A(e,i),A(i,l),A(i,d),A(i,a),A(i,r),A(i,o),A(e,b),_&&_.m(e,null)},p(h,[c]){c&1&&s!==(s=h[0].length+"")&&Q(d,s),c&1&&u!==(u=h[0].length>1?"files":"file")&&Q(r,u),h[2]?_?_.p(h,c):(_=$(h),_.c(),_.m(e,null)):_&&(_.d(1),_=null),c&2&&k(e,"progress",h[1])},i:x,o:x,d(h){h&&M(e),_&&_.d()}}}function N(t){return t.progress*100/(t.size||0)||0}function Se(t){let e=0;return t.forEach(i=>{e+=N(i)}),document.documentElement.style.setProperty("--upload-progress-width",(e/t.length).toFixed(2)+"%"),e/t.length}function je(t,e,i){let{upload_id:l}=e,{root:s}=e,{files:d}=e,{stream_handler:a}=e,u,r=!1,o,b,_=d.map(f=>({...f,progress:0}));const h=ne();function c(f,g){i(0,_=_.map(F=>(F.orig_name===f&&(F.progress+=g),F)))}return qe(async()=>{if(u=await a(new URL(`${s}/upload_progress?upload_id=${l}`)),u==null)throw new Error("Event source is not defined");u.onmessage=async function(f){const g=JSON.parse(f.data);r||i(1,r=!0),g.msg==="done"?(u?.close(),h("done")):(i(7,o=g),c(g.orig_name,g.chunk_size))}}),Ce(()=>{(u!=null||u!=null)&&u.close()}),t.$$set=f=>{"upload_id"in f&&i(3,l=f.upload_id),"root"in f&&i(4,s=f.root),"files"in f&&i(5,d=f.files),"stream_handler"in f&&i(6,a=f.stream_handler)},t.$$.update=()=>{t.$$.dirty&1&&Se(_),t.$$.dirty&129&&i(2,b=o||_[0])},[_,r,b,l,s,d,a,o]}class Je extends te{constructor(e){super(),le(this,e,je,Ne,ie,{upload_id:3,root:4,files:5,stream_handler:6})}get upload_id(){return this.$$.ctx[3]}set upload_id(e){this.$$set({upload_id:e}),y()}get root(){return this.$$.ctx[4]}set root(e){this.$$set({root:e}),y()}get files(){return this.$$.ctx[5]}set files(e){this.$$set({files:e}),y()}get stream_handler(){return this.$$.ctx[6]}set stream_handler(e){this.$$set({stream_handler:e}),y()}}function Qe(t){let e,i,l,s,d,a,u,r,o,b,_;const h=t[27].default,c=oe(h,t,t[26],null);return{c(){e=W("button"),c&&c.c(),i=J(),l=W("input"),p(l,"aria-label","file upload"),p(l,"data-testid","file-upload"),p(l,"type","file"),p(l,"accept",s=t[16]||void 0),l.multiple=d=t[6]==="multiple"||void 0,p(l,"webkitdirectory",a=t[6]==="directory"||void 0),p(l,"mozdirectory",u=t[6]==="directory"||void 0),p(l,"class","svelte-1x5qevo"),p(e,"tabindex",r=t[9]?-1:0),p(e,"class","svelte-1x5qevo"),k(e,"hidden",t[9]),k(e,"center",t[4]),k(e,"boundedheight",t[3]),k(e,"flex",t[5]),k(e,"disable_click",t[7]),S(e,"height","100%")},m(f,g){I(f,e,g),c&&c.m(e,null),A(e,i),A(e,l),t[35](l),o=!0,b||(_=[z(l,"change",t[18]),z(e,"drag",L(O(t[28]))),z(e,"dragstart",L(O(t[29]))),z(e,"dragend",L(O(t[30]))),z(e,"dragover",L(O(t[31]))),z(e,"dragenter",L(O(t[32]))),z(e,"dragleave",L(O(t[33]))),z(e,"drop",L(O(t[34]))),z(e,"click",t[13]),z(e,"drop",t[19]),z(e,"dragenter",t[17]),z(e,"dragleave",t[17])],b=!0)},p(f,g){c&&c.p&&(!o||g[0]&67108864)&&ue(c,h,f,f[26],o?de(h,f[26],g,null):fe(f[26]),null),(!o||g[0]&65536&&s!==(s=f[16]||void 0))&&p(l,"accept",s),(!o||g[0]&64&&d!==(d=f[6]==="multiple"||void 0))&&(l.multiple=d),(!o||g[0]&64&&a!==(a=f[6]==="directory"||void 0))&&p(l,"webkitdirectory",a),(!o||g[0]&64&&u!==(u=f[6]==="directory"||void 0))&&p(l,"mozdirectory",u),(!o||g[0]&512&&r!==(r=f[9]?-1:0))&&p(e,"tabindex",r),(!o||g[0]&512)&&k(e,"hidden",f[9]),(!o||g[0]&16)&&k(e,"center",f[4]),(!o||g[0]&8)&&k(e,"boundedheight",f[3]),(!o||g[0]&32)&&k(e,"flex",f[5]),(!o||g[0]&128)&&k(e,"disable_click",f[7])},i(f){o||(q(c,f),o=!0)},o(f){T(c,f),o=!1},d(f){f&&M(e),c&&c.d(f),t[35](null),b=!1,Te(_)}}}function Ge(t){let e,i,l=!t[9]&&ee(t);return{c(){l&&l.c(),e=se()},m(s,d){l&&l.m(s,d),I(s,e,d),i=!0},p(s,d){s[9]?l&&(re(),T(l,1,1,()=>{l=null}),ae()):l?(l.p(s,d),d[0]&512&&q(l,1)):(l=ee(s),l.c(),q(l,1),l.m(e.parentNode,e))},i(s){i||(q(l),i=!0)},o(s){T(l),i=!1},d(s){s&&M(e),l&&l.d(s)}}}function He(t){let e,i,l,s,d;const a=t[27].default,u=oe(a,t,t[26],null);return{c(){e=W("button"),u&&u.c(),p(e,"tabindex",i=t[9]?-1:0),p(e,"class","svelte-1x5qevo"),k(e,"hidden",t[9]),k(e,"center",t[4]),k(e,"boundedheight",t[3]),k(e,"flex",t[5]),S(e,"height","100%")},m(r,o){I(r,e,o),u&&u.m(e,null),l=!0,s||(d=z(e,"click",t[12]),s=!0)},p(r,o){u&&u.p&&(!l||o[0]&67108864)&&ue(u,a,r,r[26],l?de(a,r[26],o,null):fe(r[26]),null),(!l||o[0]&512&&i!==(i=r[9]?-1:0))&&p(e,"tabindex",i),(!l||o[0]&512)&&k(e,"hidden",r[9]),(!l||o[0]&16)&&k(e,"center",r[4]),(!l||o[0]&8)&&k(e,"boundedheight",r[3]),(!l||o[0]&32)&&k(e,"flex",r[5])},i(r){l||(q(u,r),l=!0)},o(r){T(u,r),l=!1},d(r){r&&M(e),u&&u.d(r),s=!1,d()}}}function ee(t){let e,i;return e=new Je({props:{root:t[8],upload_id:t[14],files:t[15],stream_handler:t[11]}}),{c(){Ue(e.$$.fragment)},m(l,s){De(e,l,s),i=!0},p(l,s){const d={};s[0]&256&&(d.root=l[8]),s[0]&16384&&(d.upload_id=l[14]),s[0]&32768&&(d.files=l[15]),s[0]&2048&&(d.stream_handler=l[11]),e.$set(d)},i(l){i||(q(e.$$.fragment,l),i=!0)},o(l){T(e.$$.fragment,l),i=!1},d(l){Ie(e,l)}}}function Re(t){let e,i,l,s;const d=[He,Ge,Qe],a=[];function u(r,o){return r[0]==="clipboard"?0:r[1]&&r[10]?1:2}return e=u(t),i=a[e]=d[e](t),{c(){i.c(),l=se()},m(r,o){a[e].m(r,o),I(r,l,o),s=!0},p(r,o){let b=e;e=u(r),e===b?a[e].p(r,o):(re(),T(a[b],1,1,()=>{a[b]=null}),ae(),i=a[e],i?i.p(r,o):(i=a[e]=d[e](r),i.c()),q(i,1),i.m(l.parentNode,l))},i(r){s||(q(i),s=!0)},o(r){T(i),s=!1},d(r){r&&M(l),a[e].d(r)}}}function Ve(t,e,i){if(!t||t==="*"||t==="file/*"||Array.isArray(t)&&t.some(s=>s==="*"||s==="file/*"))return!0;let l;if(typeof t=="string")l=t.split(",").map(s=>s.trim());else if(Array.isArray(t))l=t;else return!1;return l.includes(e)||l.some(s=>{const[d]=s.split("/").map(a=>a.trim());return s.endsWith("/*")&&i.startsWith(d+"/")})}function Xe(t,e,i){let l,{$$slots:s={},$$scope:d}=e,{filetype:a=null}=e,{dragging:u=!1}=e,{boundedheight:r=!0}=e,{center:o=!0}=e,{flex:b=!0}=e,{file_count:_="single"}=e,{disable_click:h=!1}=e,{root:c}=e,{hidden:f=!1}=e,{format:g="file"}=e,{uploading:F=!1}=e,{hidden_upload:P=null}=e,{show_progress:B=!0}=e,{max_file_size:G=null}=e,{upload:H}=e,{stream_handler:K}=e,R,V,U,Z=null;const _e=()=>{if(typeof navigator<"u"){const n=navigator.userAgent.toLowerCase();return n.indexOf("iphone")>-1||n.indexOf("ipad")>-1}return!1},E=ne(),ce=["image","video","audio","text","file"],X=n=>l&&n.startsWith(".")?(Z=!0,n):l&&n.includes("file/*")?"*":n.startsWith(".")||n.endsWith("/*")?n:ce.includes(n)?n+"/*":"."+n;function he(){i(20,u=!u)}function ge(){navigator.clipboard.read().then(async n=>{for(let m=0;m<n.length;m++){const w=n[m].types.find(v=>v.startsWith("image/"));if(w){n[m].getType(w).then(async v=>{const Y=new File([v],`clipboard.${w.replace("image/","")}`);await j([Y])});break}}})}function me(){h||P&&(i(2,P.value="",P),P.click())}async function pe(n){await Me(),i(14,R=Math.random().toString(36).substring(2,15)),i(1,F=!0);try{const m=await H(n,c,R,G??1/0);return E("load",_==="single"?m?.[0]:m),i(1,F=!1),m||[]}catch(m){return E("error",m.message),i(1,F=!1),[]}}async function j(n){if(!n.length)return;let m=n.map(w=>new File([w],w instanceof File?w.name:"file",{type:w.type}));return l&&Z&&(m=m.filter(w=>be(w)?!0:(E("error",`Invalid file type: ${w.name}. Only ${a} allowed.`),!1)),m.length===0)?[]:(i(15,V=await Le(m)),await pe(V))}function be(n){return a?(Array.isArray(a)?a:[a]).some(w=>{const v=X(w);if(v.startsWith("."))return n.name.toLowerCase().endsWith(v.toLowerCase());if(v==="*")return!0;if(v.endsWith("/*")){const[Y]=v.split("/");return n.type.startsWith(Y+"/")}return n.type===v}):!0}async function ye(n){const m=n.target;if(m.files)if(g!="blob")await j(Array.from(m.files));else{if(_==="single"){E("load",m.files[0]);return}E("load",m.files)}}async function ke(n){if(i(20,u=!1),!n.dataTransfer?.files)return;const m=Array.from(n.dataTransfer.files).filter(w=>{const v="."+w.name.split(".").pop();return v&&Ve(U,v,w.type)||(v&&Array.isArray(a)?a.includes(v):v===a)?!0:(E("error",`Invalid file type only ${a} allowed.`),!1)});if(g!="blob")await j(m);else{if(_==="single"){E("load",m[0]);return}E("load",m)}}function we(n){C.call(this,t,n)}function ve(n){C.call(this,t,n)}function Ae(n){C.call(this,t,n)}function ze(n){C.call(this,t,n)}function We(n){C.call(this,t,n)}function Fe(n){C.call(this,t,n)}function Pe(n){C.call(this,t,n)}function Ee(n){Oe[n?"unshift":"push"](()=>{P=n,i(2,P)})}return t.$$set=n=>{"filetype"in n&&i(0,a=n.filetype),"dragging"in n&&i(20,u=n.dragging),"boundedheight"in n&&i(3,r=n.boundedheight),"center"in n&&i(4,o=n.center),"flex"in n&&i(5,b=n.flex),"file_count"in n&&i(6,_=n.file_count),"disable_click"in n&&i(7,h=n.disable_click),"root"in n&&i(8,c=n.root),"hidden"in n&&i(9,f=n.hidden),"format"in n&&i(21,g=n.format),"uploading"in n&&i(1,F=n.uploading),"hidden_upload"in n&&i(2,P=n.hidden_upload),"show_progress"in n&&i(10,B=n.show_progress),"max_file_size"in n&&i(22,G=n.max_file_size),"upload"in n&&i(23,H=n.upload),"stream_handler"in n&&i(11,K=n.stream_handler),"$$scope"in n&&i(26,d=n.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&33554433&&(a==null?i(16,U=null):typeof a=="string"?i(16,U=X(a)):l&&a.includes("file/*")?i(16,U="*"):(i(0,a=a.map(X)),i(16,U=a.join(", "))))},i(25,l=_e()),[a,F,P,r,o,b,_,h,c,f,B,K,ge,me,R,V,U,he,ye,ke,u,g,G,H,j,l,d,s,we,ve,Ae,ze,We,Fe,Pe,Ee]}class Ke extends te{constructor(e){super(),le(this,e,Xe,Re,ie,{filetype:0,dragging:20,boundedheight:3,center:4,flex:5,file_count:6,disable_click:7,root:8,hidden:9,format:21,uploading:1,hidden_upload:2,show_progress:10,max_file_size:22,upload:23,stream_handler:11,paste_clipboard:12,open_file_upload:13,load_files:24},null,[-1,-1])}get filetype(){return this.$$.ctx[0]}set filetype(e){this.$$set({filetype:e}),y()}get dragging(){return this.$$.ctx[20]}set dragging(e){this.$$set({dragging:e}),y()}get boundedheight(){return this.$$.ctx[3]}set boundedheight(e){this.$$set({boundedheight:e}),y()}get center(){return this.$$.ctx[4]}set center(e){this.$$set({center:e}),y()}get flex(){return this.$$.ctx[5]}set flex(e){this.$$set({flex:e}),y()}get file_count(){return this.$$.ctx[6]}set file_count(e){this.$$set({file_count:e}),y()}get disable_click(){return this.$$.ctx[7]}set disable_click(e){this.$$set({disable_click:e}),y()}get root(){return this.$$.ctx[8]}set root(e){this.$$set({root:e}),y()}get hidden(){return this.$$.ctx[9]}set hidden(e){this.$$set({hidden:e}),y()}get format(){return this.$$.ctx[21]}set format(e){this.$$set({format:e}),y()}get uploading(){return this.$$.ctx[1]}set uploading(e){this.$$set({uploading:e}),y()}get hidden_upload(){return this.$$.ctx[2]}set hidden_upload(e){this.$$set({hidden_upload:e}),y()}get show_progress(){return this.$$.ctx[10]}set show_progress(e){this.$$set({show_progress:e}),y()}get max_file_size(){return this.$$.ctx[22]}set max_file_size(e){this.$$set({max_file_size:e}),y()}get upload(){return this.$$.ctx[23]}set upload(e){this.$$set({upload:e}),y()}get stream_handler(){return this.$$.ctx[11]}set stream_handler(e){this.$$set({stream_handler:e}),y()}get paste_clipboard(){return this.$$.ctx[12]}get open_file_upload(){return this.$$.ctx[13]}get load_files(){return this.$$.ctx[24]}}export{Ke as U};
//# sourceMappingURL=Upload-BQQpOvI3.js.map
